<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>PY32F002 pyOCD STLink error (22): DP error | HexRx</title>
<meta name="keywords" content="PY32, Notes">
<meta name="description" content="After run the command to upload firmware to chip PY32F002AA15M6TU
pyocd load app.hex -t PY32F002Ax5
I got the error
0004908 C STLink error (22): DP error [__main__]
But if you try to read firmware, it works fine
pyocd&gt; savemem 0x08000000 20480 py32f002.bin
BTW pyOCD and ST-Link V2 work well with the PY32F003xx series.
The solution is to use CMSIS-DAP based programmer instead of ST-Link V2, but instead of buying a new one you can use STM32 Blue Pill board without adding any extra components, just upload the firmware https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO/blob/master/build/F103-DAP-SWO-CDC-BLUEPILL-SWD_PB8PB9.hex from the repository https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO and connect 2 wires.">
<meta name="author" content="">
<link rel="canonical" href="https://hexrx.github.io/posts/py32f002-pyocd-stlink-dp-error/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://hexrx.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://hexrx.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://hexrx.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://hexrx.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://hexrx.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://hexrx.github.io/posts/py32f002-pyocd-stlink-dp-error/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-F8HK5X7GEB"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-F8HK5X7GEB');
        }
      </script><meta property="og:url" content="https://hexrx.github.io/posts/py32f002-pyocd-stlink-dp-error/">
  <meta property="og:site_name" content="HexRx">
  <meta property="og:title" content="PY32F002 pyOCD STLink error (22): DP error">
  <meta property="og:description" content="After run the command to upload firmware to chip PY32F002AA15M6TU pyocd load app.hex -t PY32F002Ax5
I got the error 0004908 C STLink error (22): DP error [__main__]
But if you try to read firmware, it works fine pyocd&gt; savemem 0x08000000 20480 py32f002.bin
BTW pyOCD and ST-Link V2 work well with the PY32F003xx series.
The solution is to use CMSIS-DAP based programmer instead of ST-Link V2, but instead of buying a new one you can use STM32 Blue Pill board without adding any extra components, just upload the firmware https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO/blob/master/build/F103-DAP-SWO-CDC-BLUEPILL-SWD_PB8PB9.hex from the repository https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO and connect 2 wires.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-23T23:19:03+03:00">
    <meta property="article:modified_time" content="2024-09-23T23:19:03+03:00">
    <meta property="article:tag" content="PY32">
    <meta property="article:tag" content="Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PY32F002 pyOCD STLink error (22): DP error">
<meta name="twitter:description" content="After run the command to upload firmware to chip PY32F002AA15M6TU
pyocd load app.hex -t PY32F002Ax5
I got the error
0004908 C STLink error (22): DP error [__main__]
But if you try to read firmware, it works fine
pyocd&gt; savemem 0x08000000 20480 py32f002.bin
BTW pyOCD and ST-Link V2 work well with the PY32F003xx series.
The solution is to use CMSIS-DAP based programmer instead of ST-Link V2, but instead of buying a new one you can use STM32 Blue Pill board without adding any extra components, just upload the firmware https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO/blob/master/build/F103-DAP-SWO-CDC-BLUEPILL-SWD_PB8PB9.hex from the repository https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO and connect 2 wires.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://hexrx.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "PY32F002 pyOCD STLink error (22): DP error",
      "item": "https://hexrx.github.io/posts/py32f002-pyocd-stlink-dp-error/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "PY32F002 pyOCD STLink error (22): DP error",
  "name": "PY32F002 pyOCD STLink error (22): DP error",
  "description": "After run the command to upload firmware to chip PY32F002AA15M6TU pyocd load app.hex -t PY32F002Ax5\nI got the error 0004908 C STLink error (22): DP error [__main__]\nBut if you try to read firmware, it works fine pyocd\u0026gt; savemem 0x08000000 20480 py32f002.bin\nBTW pyOCD and ST-Link V2 work well with the PY32F003xx series.\nThe solution is to use CMSIS-DAP based programmer instead of ST-Link V2, but instead of buying a new one you can use STM32 Blue Pill board without adding any extra components, just upload the firmware https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO/blob/master/build/F103-DAP-SWO-CDC-BLUEPILL-SWD_PB8PB9.hex from the repository https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO and connect 2 wires.\n",
  "keywords": [
    "PY32", "Notes"
  ],
  "articleBody": "After run the command to upload firmware to chip PY32F002AA15M6TU pyocd load app.hex -t PY32F002Ax5\nI got the error 0004908 C STLink error (22): DP error [__main__]\nBut if you try to read firmware, it works fine pyocd\u003e savemem 0x08000000 20480 py32f002.bin\nBTW pyOCD and ST-Link V2 work well with the PY32F003xx series.\nThe solution is to use CMSIS-DAP based programmer instead of ST-Link V2, but instead of buying a new one you can use STM32 Blue Pill board without adding any extra components, just upload the firmware https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO/blob/master/build/F103-DAP-SWO-CDC-BLUEPILL-SWD_PB8PB9.hex from the repository https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO and connect 2 wires.\nAfter flashing Blue Pill, connect Blue Pill to your computer and connect PY32F002xx target as described below\nSTM32 Blue Pull PY32F002xx PB8 SWCLK (PA14) PB9 SWDIO (PA13) The original source of the image is http://reblag.dk/stm32\nAfter running the command you will see a new device CMSIS-DAP by ARM CMSIS-DAP pyocd list\nNow you can use a new Blue Pill based programmer to programm PY32F002 chips with pyOCD.\n",
  "wordCount" : "164",
  "inLanguage": "en",
  "datePublished": "2024-09-23T23:19:03+03:00",
  "dateModified": "2024-09-23T23:19:03+03:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://hexrx.github.io/posts/py32f002-pyocd-stlink-dp-error/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "HexRx",
    "logo": {
      "@type": "ImageObject",
      "url": "https://hexrx.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://hexrx.github.io/" accesskey="h" title="HexRx (Alt + H)">HexRx</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      PY32F002 pyOCD STLink error (22): DP error
    </h1>
    <div class="post-meta"><span title='2024-09-23 23:19:03 +0300 EEST'>September 23, 2024</span>

</div>
  </header> 
  <div class="post-content"><p>After run the command to upload firmware to chip PY32F002AA15M6TU
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pyocd load app.hex -t PY32F002Ax5</span></span></code></pre></div></p>
<p>I got the error
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ae81ff">0004908</span> C STLink error <span style="color:#f92672">(</span>22<span style="color:#f92672">)</span>: DP error <span style="color:#f92672">[</span>__main__<span style="color:#f92672">]</span></span></span></code></pre></div></p>
<p>But if you try to read firmware, it works fine
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pyocd&gt; savemem 0x08000000 <span style="color:#ae81ff">20480</span> py32f002.bin</span></span></code></pre></div></p>
<p>BTW pyOCD and ST-Link V2 work well with the PY32F003xx series.</p>
<p>The solution is to use CMSIS-DAP based programmer instead of ST-Link V2, but instead of buying a new one you can use STM32 Blue Pill board without adding any extra components, just upload the firmware <a href="https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO/blob/master/build/F103-DAP-SWO-CDC-BLUEPILL-SWD_PB8PB9.hex">https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO/blob/master/build/F103-DAP-SWO-CDC-BLUEPILL-SWD_PB8PB9.hex</a> from the repository <a href="https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO">https://github.com/RadioOperator/STM32F103C8T6_CMSIS-DAP_SWO</a> and connect 2 wires.</p>
<p>After flashing Blue Pill, connect Blue Pill to your computer and connect PY32F002xx target as described below</p>
<table>
  <thead>
      <tr>
          <th>STM32 Blue Pull</th>
          <th>PY32F002xx</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>PB8</td>
          <td>SWCLK (PA14)</td>
      </tr>
      <tr>
          <td>PB9</td>
          <td>SWDIO (PA13)</td>
      </tr>
  </tbody>
</table>
<p><img alt="STM32 Blue Pill pinout diagram" loading="lazy" src="/posts/py32f002-pyocd-stlink-dp-error/images/stm32_blue_pill_pinout_diagram.avif"></p>
<blockquote>
<p>The original source of the image is <a href="http://reblag.dk/stm32">http://reblag.dk/stm32</a></p>
</blockquote>
<p>After running the command you will see a new device <code>CMSIS-DAP by ARM CMSIS-DAP</code>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pyocd list</span></span></code></pre></div></p>
<p>Now you can use a new Blue Pill based programmer to programm PY32F002 chips with pyOCD.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://hexrx.github.io/tags/py32/">PY32</a></li>
      <li><a href="https://hexrx.github.io/tags/notes/">Notes</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>Copyright © 2024 HexRx</span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
